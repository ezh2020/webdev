<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户注册 - 智慧教学辅助平台</title>
    <!-- Element UI 样式 -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <!-- Vue -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <!-- Element UI JS -->
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", Arial, sans-serif;
            background-color: #530404;
            line-height: 1.6;
        }

        #app {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .register-container {
            width: 420px;
            padding: 30px 35px 20px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .register-title {
            text-align: center;
            font-size: 22px;
            margin-bottom: 10px;
            color: #303133;
            font-weight: 600;
        }

        .register-subtitle {
            text-align: center;
            font-size: 14px;
            color: #909399;
            margin-bottom: 20px;
        }

        .form-item {
            margin-bottom: 18px;
        }

        .role-radio-group {
            width: 100%;
            display: flex;
            justify-content: space-around;
        }

        .footer-links {
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .footer-links a {
            color: #409EFF;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        .register-button {
            width: 100%;
        }
    </style>
</head>
<body>
<div id="app">
    <div class="register-container">
        <div class="register-title">注册账号</div>
        <div class="register-subtitle">智慧教学辅助平台</div>

        <el-form
                ref="registerForm"
                :model="form"
                :rules="rules"
                label-width="80px">
            <el-form-item label="用户名" prop="username" class="form-item">
                <el-input v-model="form.username" placeholder="3-12 个字符"></el-input>
            </el-form-item>

            <el-form-item label="密码" prop="password" class="form-item">
                <el-input v-model="form.password" type="password" placeholder="6-16 个字符"></el-input>
            </el-form-item>

            <el-form-item label="确认密码" prop="confirmPassword" class="form-item">
                <el-input v-model="form.confirmPassword" type="password" placeholder="再次输入密码"></el-input>
            </el-form-item>

            <el-form-item label="身份" prop="role" class="form-item">
                <el-radio-group v-model="form.role" class="role-radio-group">
                    <el-radio label="STUDENT">学生</el-radio>
                    <el-radio label="TEACHER">教师</el-radio>
                </el-radio-group>
            </el-form-item>

            <el-form-item label="邮箱" prop="email" class="form-item">
                <el-input v-model="form.email" placeholder="用于找回密码（可选）"></el-input>
            </el-form-item>

            <el-form-item label="手机号" prop="phone" class="form-item">
                <el-input v-model="form.phone" placeholder="用于联系（可选）"></el-input>
            </el-form-item>

            <el-form-item>
                <el-button
                        type="primary"
                        class="register-button"
                        :loading="loading"
                        @click="handleRegister">
                    {{ loading ? '注册中...' : '立即注册' }}
                </el-button>
            </el-form-item>
        </el-form>

        <div class="footer-links">
            <span>已有账号？<a href="/login.html">去登录</a></span>
        </div>
    </div>
</div>

<script>
    new Vue({
        el: '#app',
        data() {
            const validateConfirmPassword = (rule, value, callback) => {
                if (value === '') {
                    callback(new Error('请再次输入密码'));
                } else if (value !== this.form.password) {
                    callback(new Error('两次输入的密码不一致'));
                } else {
                    callback();
                }
            };

            return {
                form: {
                    username: '',
                    password: '',
                    confirmPassword: '',
                    role: '',
                    email: '',
                    phone: ''
                },
                rules: {
                    username: [
                        { required: true, message: '请输入用户名', trigger: 'blur' },
                        { min: 3, max: 12, message: '用户名长度在 3 到 12 个字符', trigger: 'blur' }
                    ],
                    password: [
                        { required: true, message: '请输入密码', trigger: 'blur' },
                        { min: 6, max: 16, message: '密码长度在 6 到 16 个字符', trigger: 'blur' }
                    ],
                    confirmPassword: [
                        { validator: validateConfirmPassword, trigger: 'blur' }
                    ],
                    role: [
                        { required: true, message: '请选择身份', trigger: 'change' }
                    ]
                },
                loading: false
            };
        },
        methods: {
            handleRegister() {
                this.$refs.registerForm.validate((valid) => {
                    if (!valid) {
                        this.$message.error('请完善表单信息');
                        return;
                    }

                    this.loading = true;
                    axios.post('/api/user/register', {
                        username: this.form.username,
                        password: this.form.password,
                        role: this.form.role,
                        email: this.form.email,
                        phone: this.form.phone
                    }).then(res => {
                        this.loading = false;
                        const data = res.data;
                        if (!data.success) {
                            this.$message.error(data.message || '注册失败');
                            return;
                        }
                        this.$message({
                            message: '注册成功，请使用账号密码登录',
                            type: 'success',
                            duration: 1500,
                            onClose: () => {
                                window.location.href = '/login.html';
                            }
                        });
                    }).catch(err => {
                        this.loading = false;
                        console.error(err);
                        this.$message.error('服务器异常，请稍后重试');
                    });
                });
            }
        }
    });
</script>
</body>
</html>

